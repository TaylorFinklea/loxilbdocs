<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://loxilb-io.github.io/loxilbdocs/perf-multi/" rel="canonical"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>Perf multi - loxilb v0.8.3</title>
<link href="../css/bootstrap.min.css" rel="stylesheet"/>
<link href="../css/font-awesome.min.css" rel="stylesheet"/>
<link href="../css/base.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" rel="stylesheet"/>
<link href="../stylesheets/extra.css" rel="stylesheet"/>
<script defer="" src="../js/jquery-1.10.2.min.js"></script>
<script defer="" src="../js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-21G7NBL2BN"></script>
<script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-21G7NBL2BN');
        </script>
</head>
<body>
<div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
<div class="container">
<a class="navbar-brand" href="..">loxilb v0.8.3</a>
<!-- Expander button -->
<button class="navbar-toggler" data-target="#navbar-collapse" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<!-- Expanded navigation -->
<div class="navbar-collapse collapse" id="navbar-collapse">
<!-- Main navigation -->
<ul class="nav navbar-nav">
<li class="navitem">
<a class="nav-link" href="..">Home</a>
</li>
<li class="dropdown">
<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">How-To Guides <b class="caret"></b></a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../run/">How-To - build/run</a>
</li>
<li>
<a class="dropdown-item" href="../cmd/">How-To - configuration</a>
</li>
<li>
<a class="dropdown-item" href="../kube-loxilb/">How-To - kube-loxilb</a>
</li>
<li>
<a class="dropdown-item" href="../ccm/">How-To - ccm plugin</a>
</li>
<li>
<a class="dropdown-item" href="../debugging/">How-To - debug</a>
</li>
<li>
<a class="dropdown-item" href="../integrate_bgp_eng/">How-To - loxilb with calico bgp</a>
</li>
<li>
<a class="dropdown-item" href="../standalone/">How-To - loxilb in standalone mode</a>
</li>
<li>
<a class="dropdown-item" href="../api/">How-To - loxilb Web-APIs</a>
</li>
</ul>
</li>
<li class="dropdown">
<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Knowledge Base <b class="caret"></b></a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../ebpf/">What is eBPF</a>
</li>
<li>
<a class="dropdown-item" href="../lb/">What is k8s service - load-balancer</a>
</li>
<li>
<a class="dropdown-item" href="../arch/">Architecture in brief</a>
</li>
<li>
<a class="dropdown-item" href="../code/">Code organization</a>
</li>
<li>
<a class="dropdown-item" href="../loxilbebpf/">eBPF internals</a>
</li>
<li>
<a class="dropdown-item" href="../nat/">NAT Modes of loxilb</a>
</li>
<li>
<a class="dropdown-item" href="../cmd-dev/">Developer's guide to loxicmd</a>
</li>
<li>
<a class="dropdown-item" href="../api-dev/">Developer's guide to loxilb API</a>
</li>
<li>
<a class="dropdown-item" href="../perf/">Performance Report</a>
</li>
<li>
<a class="dropdown-item" href="../roadmap/">Development Roadmap</a>
</li>
<li>
<a class="dropdown-item" href="../contribute/">Contribution Guide</a>
</li>
<li>
<a class="dropdown-item" href="../requirements/">System Requirements</a>
</li>
<li>
<a class="dropdown-item" href="../faq/">Frequenctly Asked Questions- FAQs</a>
</li>
</ul>
</li>
<li class="dropdown">
<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Blogs <b class="caret"></b></a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="https://www.loxilb.io/post/loxilb-load-balancer-setup-on-eks">Getting started with loxilb on Amazon EKS</a>
</li>
<li>
<a class="dropdown-item" href="https://www.loxilb.io/post/k8s-deploying-hitless-and-ha-load-balancing">K8s - Deploying hitless Load-Balancing</a>
</li>
<li>
<a class="dropdown-item" href="https://www.loxilb.io/post/k8s-exposing-ipv4-services-externally-as-ipv6">Ipv6 migration in Kubernetes made easy</a>
</li>
<li class="dropdown-submenu">
<a class="dropdown-item" href="#">Community Posts</a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="https://futuredon.medium.com/5g-sctp-loadbalancer-using-loxilb-b525198a9103">5G SCTP LoadBalancer Using loxilb</a>
</li>
<li>
<a class="dropdown-item" href="https://futuredon.medium.com/5g-uplink-classifier-using-loxilb-7593a4d66f4c">5G Uplink Classifier Using loxilb</a>
</li>
<li>
<a class="dropdown-item" href="https://cloudybytes.medium.com/k3s-using-loxilb-as-external-service-lb-2ea4ce61e159">K3s - Using loxilb as external service lb</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul class="nav navbar-nav ml-auto">
</ul>
</div>
</div>
</div>
<div class="container">
<div class="row">
<div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
<div class="navbar-header">
<button class="navbar-toggler collapsed" data-target="#toc-collapse" data-toggle="collapse" title="Table of Contents" type="button">
<span class="fa fa-angle-down"></span>
</button>
</div>
<div class="navbar-collapse collapse card bg-secondary" id="toc-collapse">
<ul class="nav flex-column">
<li class="nav-item" data-level="2"><a class="nav-link" href="#bare-metal-performance">Bare-Metal Performance</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#comparision-with-lvs">Comparision with LVS</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#conclusion">Conclusion</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</div>
</div></div>
<div class="col-md-9" role="main">
<h2 id="bare-metal-performance">Bare-Metal Performance</h2>
<p>The topology for this test is as follows :</p>
<div class="mermaid">graph LR;
    A[100.100.100.1]--&gt;B[loxilb VIP-20.20.20.1];
    B--&gt;C[31.31.31.1];
    B--&gt;D[32.32.32.1];
    B--&gt;E[17.17.17.1];
</div>
<p>All the services (hosts and end-points) run in one server and loxilb runs in a separate dedicated server. loxilb server specs used - 
<em>Intel(R) Xeon(R) Silver 4210R CPU @ 2.40GHz - 40 core RAM 125GB</em>. The description of test-tools and usage can be found <a href="docs/perf-single.md">here</a>. The following command can be used to configure lb for the given topology:</p>
<pre><code># loxicmd create lb 20.20.20.1 --tcp=2020:5001 --endpoints=31.31.31.1:1,32.32.32.1:1,17.17.17.1:1
</code></pre>
<p>In default RR mode of LoxiLB, the traffic distribution will be as follows:</p>
<div class="mermaid">
sequenceDiagram
    participant ServiceA1
    participant ServiceA2
    participant ServiceA3
    participant loxilb
    participant ServiceB_PodX
    participant ServiceB_PodY
    participant ServiceB_PodZ
    ServiceA1-&gt;&gt;loxilb: 100.100.100.1-&gt;20.20.20.1
    ServiceA2-&gt;&gt;loxilb: 101.101.101.1-&gt;20.20.20.1
    ServiceA3-&gt;&gt;loxilb: 102.102.102.1-&gt;20.20.20.1
    Note right of loxilb: Distribute the traffic in Round Robin fashion(default)!
    loxilb--&gt;&gt;ServiceB_PodX: 100.100.100.1-&gt;31.31.31.1
    loxilb--&gt;&gt;ServiceB_PodY: 101.101.101.1-&gt;32.32.32.1
    loxilb--&gt;&gt;ServiceB_PodZ: 102.102.102.1-&gt;17.17.17.1

</div>
<p>We use wrk HTTP benchmarking tool for this test as well. This is run inside the client "100.100.100.1" host.</p>
<pre><code>root@loxilb:/home/loxilb # wrk -t8 -c400 -d30s http://20.20.20.1:2020/
Running 30s test @ http://20.20.20.1:2020/
  8 threads and 400 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     2.44ms   10.58ms 222.86ms   99.14%
    Req/Sec    39.06k     4.90k   57.34k    64.62%
  9331956 requests in 30.07s, 667.47MB read
Requests/sec: 310364.26
Transfer/sec:     22.20MB
</code></pre>
<h2 id="comparision-with-lvs">Comparision with <a href="https://en.wikipedia.org/wiki/Linux_Virtual_Server">LVS</a></h2>
<p>LVS is based on linux kernel networking and is a popular open-source load-balancer. Comparision with LVS will show us how eBPF can improve on linux kernel networking</p>
<p>ipvsadm configuration(Check <a href="https://dev.to/douglasmakey/how-to-setup-simple-load-balancing-with-ipvs-demo-with-docker-4j1d">here</a> for more details)</p>
<pre><code>root@1167483bd551:/# ip addr add 20.20.20.1/32 dev lo
root@1167483bd551:/# ipvsadm -A -t 20.20.20.1:2020 -s rr
root@1167483bd551:/# ipvsadm -a -t 20.20.20.1:2020 -r 17.17.17.1:5001 -m
root@1167483bd551:/# ipvsadm -a -t 20.20.20.1:2020 -r 31.31.31.1:5001 -m
root@1167483bd551:/# ipvsadm -a -t 20.20.20.1:2020 -r 32.32.32.1:5001 -m
</code></pre>
<p>We use wrk HTTP benchmarking tool for this test as well. This is run inside the client "100.100.100.1" host.</p>
<pre><code>root@loxilb:/home/loxilb # wrk -t8 -c400 -d30s http://20.20.20.1:2020/
Running 30s test @ http://20.20.20.1:2020/
  8 threads and 400 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     3.81ms   17.66ms 222.32ms   98.02%
    Req/Sec    37.35k     3.72k  115.09k    72.18%
  8925647 requests in 30.10s, 638.41MB read
Requests/sec: 296537.63
Transfer/sec:     21.21MB
</code></pre>
<p>ipvsadm statistics</p>
<pre><code>root@1167483bd551:/# ipvsadm -l --stats
IP Virtual Server version 1.2.1 (size=4096)
Prot LocalAddress:Port               Conns   InPkts  OutPkts  InBytes OutBytes
  -&gt; RemoteAddress:Port
TCP  20.20.20.1:2020                   401  8939187  8953980  830843K    1135M
  -&gt; 17.17.17.1:5001                   134  3026088  3031335  281255K  384268K
  -&gt; 1.31.31.31.dyn.idknet.com:50      133  2959491  2964454  275069K  375809K
  -&gt; 32.32.32.1:5001                   134  2953608  2958191  274518K  375034K
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>loxilb's latency is 2.44 ms which is much less as compared to 3.81 ms in case of LVS. Number of Requests handled per second is 39.06K with loxilb, better than 37.35K with LVS.</p></div>
</div>
</div>
<footer class="col-md-12">
<hr/>
<p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
</footer>
<script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
<script defer="" src="../js/base.js"></script>
<div aria-hidden="true" aria-labelledby="keyboardModalLabel" class="modal" id="mkdocs_keyboard_modal" role="dialog" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
<button class="close" data-dismiss="modal" type="button"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
</div>
<div class="modal-body">
<table class="table">
<thead>
<tr>
<th style="width: 20%;">Keys</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="help shortcut"><kbd>?</kbd></td>
<td>Open this help</td>
</tr>
<tr>
<td class="next shortcut"><kbd>n</kbd></td>
<td>Next page</td>
</tr>
<tr>
<td class="prev shortcut"><kbd>p</kbd></td>
<td>Previous page</td>
</tr>
<tr>
<td class="search shortcut"><kbd>s</kbd></td>
<td>Search</td>
</tr>
</tbody>
</table>
</div>
<div class="modal-footer">
</div>
</div>
</div>
</div>
<script src="https://unpkg.com/mermaid@8.8.0/dist/mermaid.min.js"></script><script>mermaid.initialize({});</script></body>
</html>
